# Узловая железнодорожная станция
Система для работника узловой железнодорожной станции, написана на Python + PostgreSQL. В качестве графической библиотеки используется PyQt. В приложении можно принимать, отправлять, переформировывать поезда, и создавать разнообразные отчеты по грузоперевозкам. Выполнена в рамках семестрового проекта по дисциплине "Базы данных" в петербургском Политехническом университете.
## Условие задания

На станцию приходят товарные поезда (текстовый файл с описанием поезда), 
перегруппировываются в другие поезда и отправляются дальше. 

Поезд: номер, количество вагонов, список вагонов. 

Вагон: номер, категория груза, груз, вес нетто, вес брутто, отправитель, станция назначения, станция приписки. 

Есть сеть железнодорожных станций (произвольный граф, где от нашей станции существует не менее одного пути к любой другой 
станции или непосредственно, или через другие узловые станции. Часть вагонов может ехать 
только до нашей станции. Пустые вагоны после разгрузки отправляются на станцию 
приписки (участвуют в формировании поезда). Количество путей равно количеству соседей в 
графе. Ограничение для формируемых поездов: количество вагонов – N, предельная масса – K
тонн. Формируемый поезд занимает путь, пока не отправим. Как только поезд отправили, 
сразу начинаем формировать новый поезд на этом пути. Параметры N и K задаются НЕ пользователем, а ***являются технической характеристикой, уникальной для КАЖДОГО перегона, 
то есть для каждого ребра графа***.

Требуется:

• Поддержка приема поезда и его переформирование (вагоны, которые дальше не едут, 
освобождаем и собираем в обратный поезд; другие вагоны сортируем по направлениям 
(формируемым поездам)

• Поддержка отправки сформированных поездов (автоматическая отсечка готовности 
поезда; определение станции назначения, отправка)

• Поддержка формирования описания сформированного поезда (текстовый файл) с 
указанием ближайшей станции, до которой идет поезд


Отчёты:

• Перечень принимаемых на текущую дату поездов

• Перечень формируемых на текущую дату поездов

• Грузооборот станции за произвольный период (с разбивкой по категориям грузов)

• Количество «пустых» принятых/сформированных поездов и среднее отношение вагонов 
с грузом к пустым в сформированных поездах


Дополнительные соглашения предметной области:
Помимо уникального номера в базе данных (id) используется внутренний уникальный номер 
для поездов (NRTxxx) и для вагонов (NRWxxxx) для удобства восприятия информации 
пользователю программы и оптимизации некоторых функций.

## Описание входных данных
### train1.txt, train2.txt, ..., trainP.txt, ...
Файлы с принимаемыми поездами. Содержат в себе информацию о принимаемом поезде и о его вагонах.
### numbers_trains.txt и number_wagons.txt
Файлы с допустимыми номерами поездов и вагонов для данной железнодорожной сети. Могут быть изменены по желанию.
### stations.txt
Файл с номерами и названиями станций сети. В качестве примера используется железнодорожная сеть Норильска (с добавлением некоторых выдуманных станций, чтобы заполнить граф)
### network_stations.txt
Граф железнодорожной сети, задан аналитически перечислением всех ребер (в качестве вершин используются номера станций из файла stations.txt)
### railway_characteristics.txt
Файл с параметрами N и K, то есть с технической характеристикой каждого перегона в сети; i-ая строчка этого файла соответствует технической характеристики перегона на i-ой строчке файла network_stations.txt.

## Основные принципы рвботы программы
Программа запускается из файла main.py. Пользователь вводит текущую станцию, на которой он находится (на выбор любая станция из списка станций данной ж/д сети), текущую дату, и может начинать работу. Прием поездов осуществляется загрузкой их файлов. Переформирование поезда осуществляется ***автоматически***, программа сама выбирает, какой вагон на какой перегон поставить, учитывая технические характеристик перегонов и станцию назначения вагона. Если вагон пуст, то учитывается станция приписки. От работника требуется только выбирать перегоны. Все пустые вагоны, для которых выбранная пользователем станция является станцией приписки, отправляются в так называемое "депо" - это отдельная таблица в БД, в которой хранятся вагоны нашей станции. Впоследствии мы не сможем принимать вагоны с таким же номером (это означает ошибку, так как к нам на станцию не может прийти вагон с номером NRW2345, если вагон с номером NRW2345 уже находится в депо). Как только пользователь закончит работу на сегодня, он закрывает программу. Соответственно, если он на следующий день приходит на работу, то он должен ввести ***ту же станцию, что вводил вчера***, и текущую дату. Таким образом, станция выбирается один раз, и далее нужно работать с ней (либо же очищать базу данных и начинать заново). По истечении любого времени пользователь может создавать отчеты, в частности отчет по грузоперевозкам, в котором указывается кол-во пройденных грузов (по типам грузов) через выбранную станцию, и отчет по эффективности станции, который показывает, как много пустых вагонов мы держим при формировании поезда на перегонах. Также пользователь во время работы может следить за принятыми и формируемыми поездами через соответствующие отчеты. 

Как только поезд сформирован, в приложении внизу высвечивается предупреждение о том, что поезд готов к отправке. От пользователя требуется перейти в соответствующий раздел отправки поезда и отправить его. Информация об отправленных поездах и их вагонах хранится в таблицах БД. После отправки поезда перегон освобождается, и процесс начинается заново.

## Используемая база данных
В файле Railway_Junction_bd.sql хранится резервная копия базы данных. С помощью этого файла можно восстановить полностью структуры используемой БД в приложении pgAdmin4. Для этого в pgAdmin4 создается пустая база данных, ПКМ по ней, и в выпадающем окошке выбирается пункт Restore. В открывшемся окне в filename указывается данный файл. В scheme.png указана схема базы данных.
### trains и wagons
Эти таблицы используются как "разделочные доски" -- в них загружается вся информация о принятых поездах и их вагонах.
### form_trains и wagons_for_form_trains
Эти таблицы используются при переформировании поездов на перегонах.
### sent_trains и sent_wagons
Накопительные таблицы, хранящие информацию об отправленных поездах и вагонах
### all_wagons и all_trains
Таблицы, хранящие допустимые номера поездов и вагонов в данной ж/д сети
### our_wagons
Так называемое "депо" для выбранной станции, где хранятся пустые вагоны, чья станция приписки совпадает с выбранной работником станцией
### station_success_trains
Вспомогательная таблица, хранит кол-во пустых вагонов при формировании, чтобы высчитывать "эффективность" станции
### reception_wagons
Накопительная таблица, хранящая информацию о принятых вагонах и их грузах
### stations
Таблица, хранящая станции
### network_stations
Таблица, хранящая граф, то есть железнодорожную сеть
### neighbour_stations
Специальная таблица, которая уникальна для каждой станции. С помощью нее высчитывается, на какой перегон надо ставить вагон в зависимости от его станции назначения/приписки. Создается с помощью алгоритма Дейкстры для графа каждый раз при выборе станции.

